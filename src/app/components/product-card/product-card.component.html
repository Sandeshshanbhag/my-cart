<div class="product-card">
  <!-- Favorite Button -->
  <button class="favorite-btn" (click)="toggleFavorite()" [class.active]="isFavorite$ | async"
    title="Toggle Favorite">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
      [attr.fill]="(isFavorite$ | async) ? '#ef4444' : 'none'" stroke="currentColor" stroke-width="2"
      stroke-linecap="round" stroke-linejoin="round">
      <path
        d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" />
    </svg>
  </button>

  <!-- Product Image -->
  <div class="product-image">
    <img [src]="product.image" [alt]="product.title" loading="lazy" />
  </div>

  <!-- Product Info -->
  <div class="product-info">
    <h4 class="product-title">{{ product.title }}</h4>

    <div class="product-category">{{ product.category }}</div>

    <!-- Rating -->
    <div class="product-rating">
      <div class="stars">
        <svg *ngFor="let star of getStars(product.rating.rate)" xmlns="http://www.w3.org/2000/svg" width="14"
          height="14" viewBox="0 0 24 24" [attr.fill]="star ? '#f59e0b' : 'none'"
          [attr.stroke]="star ? '#f59e0b' : '#d1d5db'" stroke-width="2" stroke-linecap="round"
          stroke-linejoin="round">
          <polygon
            points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />
        </svg>
      </div>
      <span class="rating-text">{{ product.rating.rate }}</span>
      <span class="review-count">({{ product.rating.count }} reviews)</span>
    </div>

    <!-- Price & Add to Cart -->
    <div class="product-footer">
      <div class="product-price">${{ product.price | number:'1.2-2' }}</div>

      <!-- Quantity Counter (shown when item is in cart) -->
      <div class="quantity-control" *ngIf="(cartQuantity$ | async) as qty; else addBtn">
        <button class="qty-btn minus" (click)="decrementCart()" title="Decrease quantity">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <line x1="5" y1="12" x2="19" y2="12" />
          </svg>
        </button>
        <span class="qty-count">{{ qty }}</span>
        <button class="qty-btn plus" (click)="incrementCart()" title="Increase quantity">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19" />
            <line x1="5" y1="12" x2="19" y2="12" />
          </svg>
        </button>
      </div>

      <!-- Add to Cart Button (shown when item is NOT in cart) -->
      <ng-template #addBtn>
        <button class="add-to-cart-btn" (click)="addToCart()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="9" cy="21" r="1" />
            <circle cx="20" cy="21" r="1" />
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6" />
          </svg>
          Add to Cart
        </button>
      </ng-template>
    </div>
  </div>
</div>
