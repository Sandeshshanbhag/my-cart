<div class="create-product-container">
  <!-- Header -->
  <div class="page-header">
    <button class="back-btn" (click)="goBack()">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="19" y1="12" x2="5" y2="12" />
        <polyline points="12 19 5 12 12 5" />
      </svg>
      Back to Home
    </button>
    <h1>
      <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10" />
        <line x1="12" y1="8" x2="12" y2="16" />
        <line x1="8" y1="12" x2="16" y2="12" />
      </svg>
      Product Management
    </h1>
    <p>Create and manage your store products</p>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab-btn" [class.active]="activeTab === 'create'" (click)="switchTab('create')">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="12" y1="5" x2="12" y2="19" />
        <line x1="5" y1="12" x2="19" y2="12" />
      </svg>
      Create Product
    </button>
    <button class="tab-btn" [class.active]="activeTab === 'my-products'" (click)="switchTab('my-products')">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="2" y="7" width="20" height="14" rx="2" ry="2" />
        <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" />
      </svg>
      My Products
      <span class="tab-count" *ngIf="myProducts.length > 0">{{ myProducts.length }}</span>
    </button>
    <button class="tab-btn" *ngIf="isSuperAdmin" [class.active]="activeTab === 'manage-admins'" (click)="switchTab('manage-admins')">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
        <circle cx="9" cy="7" r="4" />
        <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
        <path d="M16 3.13a4 4 0 0 1 0 7.75" />
      </svg>
      Manage Admins
      <span class="tab-count" *ngIf="adminRequests.length > 0">{{ adminRequests.length }}</span>
    </button>
    <button class="tab-btn" *ngIf="isSuperAdmin" [class.active]="activeTab === 'users'" (click)="switchTab('users')">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
        <circle cx="9" cy="7" r="4" />
        <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
        <path d="M16 3.13a4 4 0 0 1 0 7.75" />
      </svg>
      Users
      <span class="tab-count" *ngIf="allUsers.length > 0">{{ allUsers.length }}</span>
    </button>
  </div>

  <!-- CREATE TAB -->
  <div *ngIf="activeTab === 'create'">
    <!-- Success Message -->
    <div class="success-banner" *ngIf="submitted">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
        <polyline points="22 4 12 14.01 9 11.01" />
      </svg>
      Product created successfully!
    </div>

    <!-- Error Message -->
    <div class="error-banner" *ngIf="errorMessage">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10" />
        <line x1="15" y1="9" x2="9" y2="15" />
        <line x1="9" y1="9" x2="15" y2="15" />
      </svg>
      {{ errorMessage }}
    </div>

    <!-- Form -->
    <div class="form-layout">
      <div class="form-card">
        <h2 class="form-section-title">Product Details</h2>

        <!-- Title -->
        <div class="form-group">
          <label for="title">Product Title <span class="required">*</span></label>
          <input type="text" id="title" [(ngModel)]="product.title"
            placeholder="e.g. iPhone 16 Pro Max - 256GB" />
        </div>

        <!-- Price -->
        <div class="form-group">
          <label for="price">Price (USD) <span class="required">*</span></label>
          <div class="price-input">
            <span class="currency">$</span>
            <input type="number" id="price" [(ngModel)]="product.price"
              placeholder="0.00" min="0" step="0.01" />
          </div>
        </div>

        <!-- Category -->
        <div class="form-group">
          <label for="category">Category <span class="required">*</span></label>
          <select id="category" [(ngModel)]="product.category">
            <option value="" disabled>Select a category</option>
            <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
          </select>
        </div>

        <!-- Description -->
        <div class="form-group">
          <label for="description">Description <span class="required">*</span></label>
          <textarea id="description" [(ngModel)]="product.description"
            placeholder="Describe the product features, specifications, etc."
            rows="4"></textarea>
        </div>

        <!-- Image URL -->
        <div class="form-group">
          <label for="image">Image URL <span class="required">*</span></label>
          <input type="url" id="image" [(ngModel)]="product.image"
            placeholder="https://example.com/product-image.jpg" />
        </div>

        <!-- Submit -->
        <div class="form-actions">
          <button class="cancel-btn" (click)="resetForm()">Reset</button>
          <button class="submit-btn" (click)="onSubmit()"
            [disabled]="!isFormValid() || submitting">
            <span *ngIf="!submitting">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19" />
                <line x1="5" y1="12" x2="19" y2="12" />
              </svg>
              Create Product
            </span>
            <span *ngIf="submitting" class="btn-loading">
              <span class="spinner"></span>
              Creating...
            </span>
          </button>
        </div>
      </div>

      <!-- Image Preview -->
      <div class="preview-card">
        <h2 class="form-section-title">Preview</h2>
        <div class="preview-product">
          <div class="preview-image">
            <img *ngIf="product.image && !imagePreviewError"
              [src]="product.image" alt="Preview"
              (error)="onImageError()" (load)="onImageLoad()" />
            <div *ngIf="!product.image || imagePreviewError" class="image-placeholder">
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                stroke="#d1d5db" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                <circle cx="8.5" cy="8.5" r="1.5" />
                <polyline points="21 15 16 10 5 21" />
              </svg>
              <p>Image preview</p>
            </div>
          </div>
          <div class="preview-info">
            <h4>{{ product.title || 'Product Title' }}</h4>
            <span class="preview-category">{{ product.category || 'Category' }}</span>
            <div class="preview-price">${{ (product.price || 0) | number:'1.2-2' }}</div>
            <p class="preview-desc">{{ product.description || 'Product description will appear here...' }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MY PRODUCTS TAB -->
  <div *ngIf="activeTab === 'my-products'" class="my-products-section">
    <!-- Loading -->
    <div class="my-products-loading" *ngIf="loadingMyProducts">
      <div class="loading-spinner"></div>
      <p>Loading your products...</p>
    </div>

    <!-- Empty State -->
    <div class="my-products-empty" *ngIf="!loadingMyProducts && myProducts.length === 0">
      <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none"
        stroke="#d1d5db" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <rect x="2" y="7" width="20" height="14" rx="2" ry="2" />
        <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" />
      </svg>
      <h3>No products yet</h3>
      <p>Products you create will appear here</p>
      <button class="switch-tab-btn" (click)="switchTab('create')">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="5" x2="12" y2="19" />
          <line x1="5" y1="12" x2="19" y2="12" />
        </svg>
        Create Your First Product
      </button>
    </div>

    <!-- Products Grid -->
    <div class="my-products-grid" *ngIf="!loadingMyProducts && myProducts.length > 0">
      <div class="my-product-card" *ngFor="let p of myProducts" [class.deleting]="deletingId === p.id">
        <div class="my-product-image">
          <img [src]="p.image" [alt]="p.title" />
          <button class="delete-btn" (click)="deleteProduct(p)" [disabled]="deletingId === p.id"
            title="Delete product">
            <svg *ngIf="deletingId !== p.id" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="3 6 5 6 21 6" />
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
              <line x1="10" y1="11" x2="10" y2="17" />
              <line x1="14" y1="11" x2="14" y2="17" />
            </svg>
            <span class="delete-spinner" *ngIf="deletingId === p.id"></span>
          </button>
        </div>
        <div class="my-product-info">
          <h4>{{ p.title }}</h4>
          <span class="my-product-category">{{ p.category }}</span>
          <div class="my-product-rating" *ngIf="p.rating && p.rating.rate > 0">
            <span class="stars">â˜…</span>
            <span>{{ p.rating.rate }} ({{ p.rating.count }})</span>
          </div>
          <div class="my-product-rating no-rating" *ngIf="!p.rating || p.rating.rate === 0">
            <span>No ratings yet</span>
          </div>
          <div class="my-product-price">${{ p.price | number:'1.2-2' }}</div>
          <p class="my-product-desc">{{ p.description }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- MANAGE ADMINS TAB -->
  <div *ngIf="activeTab === 'manage-admins'" class="manage-admins-section">
    <!-- Loading -->
    <div class="my-products-loading" *ngIf="loadingAdmins">
      <div class="loading-spinner"></div>
      <p>Loading admin data...</p>
    </div>

    <div *ngIf="!loadingAdmins">
      <!-- Pending Requests -->
      <div class="admin-panel" *ngIf="adminRequests.length > 0">
        <h2 class="panel-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10" />
            <line x1="12" y1="8" x2="12" y2="12" />
            <line x1="12" y1="16" x2="12.01" y2="16" />
          </svg>
          Pending Requests
          <span class="badge pending">{{ adminRequests.length }}</span>
        </h2>
        <div class="request-list">
          <div class="request-card" *ngFor="let req of adminRequests"
            [class.processing]="processingRequestId === req.id">
            <div class="request-info">
              <div class="request-user">
                <div class="avatar">{{ req.userName.charAt(0).toUpperCase() }}</div>
                <div>
                  <h4>{{ req.userName }}</h4>
                  <span class="request-email">{{ req.userEmail }}</span>
                </div>
              </div>
              <p class="request-reason">"{{ req.reason }}"</p>
              <span class="request-date">{{ req.requestedAt | date:'medium' }}</span>
            </div>
            <div class="request-actions">
              <button class="approve-btn" (click)="approveRequest(req)"
                [disabled]="processingRequestId === req.id">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="20 6 9 17 4 12" />
                </svg>
                Approve
              </button>
              <button class="reject-btn" (click)="rejectRequest(req)"
                [disabled]="processingRequestId === req.id">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="18" y1="6" x2="6" y2="18" />
                  <line x1="6" y1="6" x2="18" y2="18" />
                </svg>
                Reject
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Admin Users List -->
      <div class="admin-panel">
        <h2 class="panel-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
          </svg>
          Admin Users
          <span class="badge">{{ adminUsers.length }}</span>
        </h2>
        <div class="admin-list">
          <div class="admin-card" *ngFor="let admin of adminUsers"
            [class.removing]="removingEmail === admin.email">
            <div class="admin-info">
              <div class="avatar" [class.super]="admin.role === 'superAdmin'">
                {{ admin.email.charAt(0).toUpperCase() }}
              </div>
              <div class="admin-details">
                <h4>
                  {{ admin.email }}
                  <span class="role-badge super" *ngIf="admin.role === 'superAdmin'">Super Admin</span>
                  <span class="role-badge" *ngIf="admin.role !== 'superAdmin'">Admin</span>
                </h4>
                <span class="admin-date">Added {{ admin.grantedAt | date:'mediumDate' }}</span>
              </div>
            </div>
            <button class="remove-btn"
              *ngIf="admin.role !== 'superAdmin'"
              (click)="openRemoveModal(admin)"
              [disabled]="removingEmail === admin.email">
              <svg *ngIf="removingEmail !== admin.email" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                <circle cx="9" cy="7" r="4" />
                <line x1="23" y1="11" x2="17" y2="11" />
              </svg>
              <span class="delete-spinner" *ngIf="removingEmail === admin.email"></span>
              {{ removingEmail === admin.email ? 'Removing...' : 'Remove Access' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- USERS TAB -->
  <div *ngIf="activeTab === 'users'" class="users-section">
    <!-- Loading -->
    <div class="my-products-loading" *ngIf="loadingUsers">
      <div class="loading-spinner"></div>
      <p>Loading users...</p>
    </div>

    <div *ngIf="!loadingUsers">
      <!-- Stats Cards -->
      <div class="user-stats">
        <div class="stat-card">
          <div class="stat-icon users-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
              <circle cx="9" cy="7" r="4" />
              <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
              <path d="M16 3.13a4 4 0 0 1 0 7.75" />
            </svg>
          </div>
          <div class="stat-info">
            <span class="stat-value">{{ allUsers.length }}</span>
            <span class="stat-label">Total Users</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon logins-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4" />
              <polyline points="10 17 15 12 10 7" />
              <line x1="15" y1="12" x2="3" y2="12" />
            </svg>
          </div>
          <div class="stat-info">
            <span class="stat-value">{{ totalLogins }}</span>
            <span class="stat-label">Total Logins</span>
          </div>
        </div>
      </div>

      <!-- Search -->
      <div class="user-search-bar">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8" />
          <line x1="21" y1="21" x2="16.65" y2="16.65" />
        </svg>
        <input type="text" [(ngModel)]="userSearchQuery" placeholder="Search users by name or email..." />
      </div>

      <!-- Empty State -->
      <div class="my-products-empty" *ngIf="allUsers.length === 0">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none"
          stroke="#d1d5db" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
          <circle cx="9" cy="7" r="4" />
        </svg>
        <h3>No users tracked yet</h3>
        <p>User data will appear here once users log in</p>
      </div>

      <!-- Users Table -->
      <div class="users-table-container" *ngIf="filteredUsers.length > 0">
        <table class="users-table">
          <thead>
            <tr>
              <th>#</th>
              <th>User</th>
              <th>Email</th>
              <th>Login Count</th>
              <th>Last Login</th>
              <th>Registered</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let user of filteredUsers; let i = index">
              <td class="row-num">{{ i + 1 }}</td>
              <td class="user-cell">
                <div class="user-avatar">{{ user.name.charAt(0).toUpperCase() }}</div>
                <span class="user-name">{{ user.name }}</span>
              </td>
              <td class="email-cell">{{ user.email }}</td>
              <td class="login-count-cell">
                <span class="login-badge" [class.high]="user.loginCount >= 10" [class.medium]="user.loginCount >= 5 && user.loginCount < 10">
                  {{ user.loginCount }}
                </span>
              </td>
              <td class="date-cell">{{ user.lastLoginAt | date:'medium' }}</td>
              <td class="date-cell">{{ user.registeredAt | date:'mediumDate' }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- No Search Results -->
      <div class="my-products-empty" *ngIf="allUsers.length > 0 && filteredUsers.length === 0">
        <h3>No users found</h3>
        <p>No users matching "{{ userSearchQuery }}"</p>
      </div>
    </div>
  </div>

  <!-- Remove Admin Modal -->
  <div class="modal-overlay" *ngIf="showRemoveModal" (click)="closeRemoveModal()">
    <div class="remove-modal" (click)="$event.stopPropagation()">
      <div class="remove-modal-header">
        <div class="remove-modal-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
            <circle cx="9" cy="7" r="4" />
            <line x1="23" y1="11" x2="17" y2="11" />
          </svg>
        </div>
        <h3>Remove Admin Access</h3>
        <p>You are about to remove admin access for:</p>
        <div class="remove-target-user">
          <div class="avatar">{{ removeTargetAdmin?.email?.charAt(0)?.toUpperCase() }}</div>
          <span>{{ removeTargetAdmin?.email }}</span>
        </div>
      </div>
      <div class="remove-modal-body">
        <label for="removeReason">Reason for removal <span class="required">*</span></label>
        <textarea id="removeReason" [(ngModel)]="removeReason"
          placeholder="Explain why admin access is being revoked. The user will be able to see this reason."
          rows="3"></textarea>
      </div>
      <div class="remove-modal-actions">
        <button class="cancel-modal-btn" (click)="closeRemoveModal()">Cancel</button>
        <button class="confirm-remove-btn" (click)="confirmRemoveAdmin()"
          [disabled]="!removeReason.trim() || removeSubmitting">
          <span *ngIf="!removeSubmitting">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
              <circle cx="9" cy="7" r="4" />
              <line x1="23" y1="11" x2="17" y2="11" />
            </svg>
            Remove Access
          </span>
          <span *ngIf="removeSubmitting" class="btn-loading">
            <span class="spinner"></span>
            Removing...
          </span>
        </button>
      </div>
    </div>
  </div>
</div>
